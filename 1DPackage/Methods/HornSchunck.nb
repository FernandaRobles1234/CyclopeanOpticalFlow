(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.2' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     23618,        579]
NotebookOptionsPosition[     21602,        538]
NotebookOutlinePosition[     22058,        555]
CellTagsIndexPosition[     22015,        552]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["HornSchunck", "Title",
 CellChangeTimes->{{3.836408933336395*^9, 3.836408939343516*^9}, 
   3.8364092608930736`*^9, {3.839597016893468*^9, 3.839597019185139*^9}, 
   3.8396001415844855`*^9, {3.840547036727909*^9, 3.8405470374003563`*^9}, {
   3.843157046858073*^9, 3.8431570473239956`*^9}, 3.843746389245494*^9, {
   3.843747216246171*^9, 3.8437472272964706`*^9}, {3.8437522034332137`*^9, 
   3.843752204235346*^9}, 3.843831097875743*^9, {3.8577430521773357`*^9, 
   3.8577430557886467`*^9}},ExpressionUUID->"c7890b51-e7b4-4fef-b7f7-\
d75a1e472cd0"],

Cell[CellGroupData[{

Cell["Start", "Section",
 CellChangeTimes->{{3.8321935354974017`*^9, 3.8321935380848103`*^9}, {
  3.8363952278003016`*^9, 3.8363952460112877`*^9}, {3.8431530928617816`*^9, 
  3.8431531095074196`*^9}, {3.8431536160653305`*^9, 3.843153621995445*^9}, {
  3.843752212635614*^9, 
  3.8437522150627623`*^9}},ExpressionUUID->"e88658b6-d70f-43e0-bf8f-\
0fbc4dd6965f"],

Cell[BoxData[
 RowBox[{"SetOptions", "[", 
  RowBox[{
   RowBox[{"InputNotebook", "[", "]"}], ",", 
   RowBox[{"AutoGeneratedPackage", "\[Rule]", "Automatic"}]}], "]"}]], "Input",
 CellChangeTimes->{
  3.832189670547576*^9, {3.8372610411417527`*^9, 3.837261053402938*^9}, 
   3.8372611225950527`*^9, {3.8431523924971895`*^9, 3.84315239273125*^9}},
 CellLabel->
  "In[175]:=",ExpressionUUID->"5ded1e1c-cacc-4124-ae6f-cae13c483669"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"packageDirectory", "=", 
   RowBox[{"FileNameJoin", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"ParentDirectory", "[", 
       RowBox[{"NotebookDirectory", "[", "]"}], "]"}], ",", "\"\<*\>\""}], 
     "}"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"$Path", "=", 
   RowBox[{"Join", "[", 
    RowBox[{"$Path", ",", 
     RowBox[{"FileNames", "[", "packageDirectory", "]"}]}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{3.843747298847076*^9},
 CellLabel->
  "In[176]:=",ExpressionUUID->"fb634eba-f95f-4387-a906-abb7f9c65b2a"],

Cell[BoxData[{
 RowBox[{"<<", "\"\<pyramid1d`\>\""}], "\[IndentingNewLine]", 
 RowBox[{"<<", "\"\<pyramidalCyclope1D`\>\""}]}], "Input",
 CellChangeTimes->{
  3.843747328636345*^9, {3.8437486091702127`*^9, 3.8437486224305134`*^9}, {
   3.8445130212660832`*^9, 3.844513027637513*^9}},
 CellLabel->
  "In[178]:=",ExpressionUUID->"bbb68d07-3330-46e0-af4b-42d17f5fc983"],

Cell[BoxData[
 RowBox[{
  RowBox[{"noteBookMode", "=", "\"\<HornSchunck\>\""}], ";"}]], "Input",
 CellChangeTimes->{
  3.8437533462956824`*^9, 3.8437535060531635`*^9, {3.8444602155397797`*^9, 
   3.844460218580969*^9}, 3.857743073968021*^9},
 CellLabel->
  "In[180]:=",ExpressionUUID->"e2e06ea2-9234-4f36-ad81-bc4587977350"]
}, Closed]],

Cell[CellGroupData[{

Cell["Test Points {line1, line2, pyrf12}", "Section",
 CellChangeTimes->{{3.8321935354974017`*^9, 3.8321935380848103`*^9}, {
  3.8363952278003016`*^9, 3.8363952460112877`*^9}, {3.8431530928617816`*^9, 
  3.8431531095074196`*^9}, {3.8431536160653305`*^9, 
  3.843153621995445*^9}},ExpressionUUID->"19bdc259-fd11-45ff-a577-\
d84476daf64c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"dis", "=", "1"}], ";"}]], "Input",
 CellChangeTimes->{{3.8527432872559943`*^9, 3.8527432891307516`*^9}, {
  3.852820564514149*^9, 3.852820594366195*^9}},
 CellLabel->
  "In[181]:=",ExpressionUUID->"854159ec-bc25-4b3c-a87a-910454c18b36"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "We", " ", "create", " ", "test", " ", "points", " ", "for", " ", 
    "compilation", " ", "test"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"line1", "=", 
     RowBox[{"GaussianFilter", "[", 
      RowBox[{
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"11", "<=", " ", "p", "<=", "18"}], ",", "1", ",", "0"}], 
          "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"p", ",", "1", ",", "30"}], "}"}]}], "]"}], ",", "1"}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"line2", "=", 
     RowBox[{"GaussianFilter", "[", 
      RowBox[{
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"11", "<=", " ", "p", "<=", "18"}], ",", "1", ",", "0"}], 
          "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"p", ",", 
           RowBox[{"1", "-", "dis"}], ",", 
           RowBox[{"30", "-", "dis"}]}], "}"}]}], "]"}], ",", "1"}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"line1", "=", 
     RowBox[{"GaussianFilter", "[", 
      RowBox[{
       RowBox[{"Table", "[", 
        RowBox[{"p", ",", 
         RowBox[{"{", 
          RowBox[{"p", ",", "1", ",", "30"}], "}"}]}], "]"}], ",", "1"}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"line2", "=", 
     RowBox[{"GaussianFilter", "[", 
      RowBox[{
       RowBox[{"Table", "[", 
        RowBox[{"p", ",", 
         RowBox[{"{", 
          RowBox[{"p", ",", 
           RowBox[{"1", "-", "dis"}], ",", 
           RowBox[{"30", "-", "dis"}]}], "}"}]}], "]"}], ",", "1"}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ListPlot", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"line1", ",", " ", "line2"}], "}"}], ",", 
      RowBox[{"Joined", "->", "True"}], ",", 
      RowBox[{"PlotMarkers", "\[Rule]", "Automatic"}], ",", 
      RowBox[{"PlotRange", "->", "All"}], ",", 
      RowBox[{"PlotLabel", "\[Rule]", "\"\<Test Points\>\""}], ",", 
      RowBox[{"PlotLegends", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{"\"\<ia\>\"", ",", "\"\<ib\>\""}], "}"}]}]}], "]"}], 
    ";"}]}]}]], "Input",
 CellChangeTimes->{{3.832269136912603*^9, 3.8322691462380075`*^9}, {
   3.8324089382989807`*^9, 3.832408951506154*^9}, {3.8324104077397842`*^9, 
   3.832410511519393*^9}, 3.832410602016293*^9, {3.832410661166127*^9, 
   3.832410748366403*^9}, {3.832411297859131*^9, 3.832411301951344*^9}, {
   3.836395098441699*^9, 3.836395118010255*^9}, {3.836396148580798*^9, 
   3.836396159588914*^9}, {3.836396194334372*^9, 3.8363962079578047`*^9}, {
   3.836398891705703*^9, 3.836398893325742*^9}, {3.8365003825221486`*^9, 
   3.83650041642003*^9}, {3.8402800509000998`*^9, 3.840280051642571*^9}, {
   3.8430474630811205`*^9, 3.843047543816728*^9}, 3.843747388415428*^9, {
   3.8445119817060966`*^9, 3.844511983305078*^9}, {3.8522966047840776`*^9, 
   3.852296606303194*^9}, {3.85274328091955*^9, 3.852743295758687*^9}, {
   3.857746750656807*^9, 3.8577467618353257`*^9}},
 CellLabel->
  "In[182]:=",ExpressionUUID->"77b35f64-33ee-4524-92a9-1aa55c2b27f3"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "generate", " ", "functions", " ", "of", " ", "pyramid", " ", "with", " ", 
    "pyrFuncGen"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"input", "\[Rule]", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"original", " ", "points"}], ",", " ", 
      RowBox[{"number", " ", "of", " ", "levels"}]}], "}"}]}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"Output", "\[Rule]", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
      "functions", " ", "f", " ", "and", " ", "df", " ", "for", " ", "n"}], 
      "+", 
      RowBox[{"1", " ", "levels"}]}], "}"}]}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"pyrf1", "=", 
     RowBox[{"pyrFuncGen", "[", 
      RowBox[{"line1", ",", "4"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"pyrf2", "=", 
     RowBox[{"pyrFuncGen", "[", 
      RowBox[{"line2", ",", "4"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"pyrf12", "=", 
     RowBox[{"Flatten", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"pyrf1", ",", " ", "pyrf2"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", "2", "}"}], ",", 
         RowBox[{"{", "1", "}"}], ",", 
         RowBox[{"{", "3", "}"}]}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"Plot", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"pyrf12", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "1", ",", "1"}], "]"}], "]"}], "[", "x", "]"}], 
       ",", 
       RowBox[{
        RowBox[{"pyrf12", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "2", ",", "1"}], "]"}], "]"}], "[", "x", "]"}]}], 
      "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"x", ",", "1", ",", "30"}], "}"}]}], "]"}]}]}]], "Input",
 CellChangeTimes->{
  3.8431536109231205`*^9, 3.84367550184682*^9, {3.8437473622190533`*^9, 
   3.8437473924405236`*^9}, {3.8445127985159717`*^9, 
   3.8445128295209723`*^9}, {3.852820576515012*^9, 3.8528205805400867`*^9}, {
   3.855166295150268*^9, 3.855166302058202*^9}, {3.8577465794655504`*^9, 
   3.8577465867836657`*^9}, {3.8577467115225067`*^9, 3.8577467132825994`*^9}},
 CellLabel->
  "In[187]:=",ExpressionUUID->"15ff7e93-620d-4108-980e-64d93642cd94"],

Cell[BoxData[
 GraphicsBox[{{{}, {}, 
    TagBox[
     {RGBColor[0.368417, 0.506779, 0.709798], AbsoluteThickness[1.6], Opacity[
      1.], LineBox[CompressedData["
1:eJwlznlM03cYBvAixzYmooWChYLIJY5ToAiWr79XM2VyHxsIU2Cgq0oRKbUC
kwICMsOh0hFxItKpSFnkHNpyDRgqlIpCIFquMKagMLHtqCu4yn6tfzz5JE/e
vHm2JqSEH11HIBCC8KiVt05XEQhSLDL9WdbGKzLsZ9f3L07aSjGI4ZqW/SbD
9vBNHae+kmIn9rYG2I/IsEuVofeFl6WYLF1pc95Ajrnm9T5h2siwUw/Jq1YF
cowRWkN4uV+OOW5tPl5/5h9sbiE5YaBkGZP0FXXmHldg41tUdmXmK9hFjMkc
y1zBzlLKDXlZWtBkKuG9Pa0Fl+cXvhGQ9UA7fe8uXZIeXFgxLeJX6UPcbvGh
QJ4+UBIDV/gFhvCONnheintNt/o5az0RdMwX861wWQUWYZRCYzhqe+6AI253
rV6P2zsTaHN3yUK4IUlPxo7QyECm5KbE4tZJzAurm8xB5D158wau/7zf1HuV
BVQEt+SpcJ3FKaSELVawXDyhpbYyM0vf/+BWMDhze/YA7l3l6vCes9YQlH9s
Ru2twDZ6p8AG8m0VSWq/ZrpmpLy1hfioNZbaGrrx4R2b7GFIFqBx2p1meCZg
Gyy9NNioVvB4mCs+5QCxpFKNGbvr5m7Xb4dXlmUa5Tnera1zX8CJ4CCNBlyv
yLHPnGBSQdVo+AP7Qfo+Z8i+x9TY7G7/iRPDBcRjH93QUdRHKnEFJvmjtSXk
2j2JbjBdaq7RzM4uKkfhBgcefjT7Ttgbwk87QJvkp7GHGN1T6eoOJ1PpGkeP
VnC6u91BSO3QOH5TaW0f6wFDm4o0Ng1cajSSecCuhgSNR55rn6XkesKrCAOO
Wv2RKy50CyrE5c86qc1tSRT5NFBBGczuVft3dmhQcJAXNOrdjVO7zfO0cGHG
CxLYD0RqsWFW4i+pO6ErzWGdWv/o8uVrG7wh1OGtRSWu/cCbkxY8b0i2rjHe
gquwoT+dwXyAXGT4xxRuNb095fcJH2A9neC041K4fkq75F2QV/za0ge3mL9M
H9KnwbCyIawfV3xH0v3hOg04mz4l8XFfl16N8nfxhWwH1qgQdyU+c+yZyBcU
pRb204O+MG7G9X1zCEEtO2k04iCCHpOMwow4BAJ5mqohBu+JcSO6CQhE/R4e
nx9GwNZ3PGZJR2AmO9fR9R0Co9VebkgqgiGq1nqzJASBEvlCUwEC7bqSwRtZ
CLquhF9l1yP4nkinSngIbnO9X6xrQiBxZiwSbyEovmjperEFwVNjVlJADYKY
woW+OwIErBZqj6AOwb/sc9LnvQgUXtYX8vE7t8hmP9ozBLGpjfen+xCYhleU
PZIg4Lt0Guk8QvAhiDMVMYlg5ynmZocBBOJ9/mmMPxGELWUbMR4jOEadrbq+
iO+V9Jf/NYYgZEf/6+1LCEo62v9T4X+9nOs970kRyNb4703GEejYZYqGFPhe
E2vhl9MIFq3iSd8qEZzm5aRFzyAYoeyPn19FML+a18mYRdC22enXNBUCIcek
nPMCAc+Y+G5tDUHmj9bK0jkE/wM0SSR+
       "]]},
     Annotation[#, "Charting`Private`Tag$55831#1"]& ], 
    TagBox[
     {RGBColor[0.880722, 0.611041, 0.142051], AbsoluteThickness[1.6], Opacity[
      1.], LineBox[CompressedData["
1:eJwVxXk01AkAB/BJxTZbqXFFM2RiUo5xzRjN79fv6+2WDYPUdm1FaKe3JsI0
rWIQsj1Hx6xXbTp0yNgXyavGMS3S5ix52UKstWKxaczDoiY7/fF5H9vwmJAD
BjQaTaT3ee393is0moaKzDjaYxRbQf3C/TAQbaehJm/wEmw3V1E+SgvHnm80
lJKzrSqSrabO5Ac/rDiroZKfPrZxk9RQ3LS653Grx6kkj2dtRmvrKUlwIe3t
Ji0VuOisKF7dTA2OHApvzJmg9ptwpwwLO6guG539uZUzFDN5YKB4sp9KZOYZ
FyTNQzj33ld/jmqps0Mj36osDWGkSZfS132kTs1YZCmv0BG6oWVPQIEBmBEB
M8oMY0wJm09qMoxwaeG119LFDBjx/1jks2IxpBmsLcxMUxywO7HZMXMZaooM
a12nzFHt7pJETjEQFPW8I1JoCStmasw+oRmKO1dmXitbiSbBmxtXyyzgN+Tb
80HHwoXA8jSdzhLOLTFm4TarMGT5cH79BibyjyXR/XbawmrM74nirjXuTM++
8ElkQ5R+sM8ncRVuBlSK1arVSLObjFKrbLEtjpsQ894OoTvmpDHv2SgUm+51
W85B67i/fjv0uguNj/qvwdjbJcuO+ttD1fpC0XLYAWFmufo5SNhQPHirZC2G
rc/pXwNtiuD+/cF1+CFQpN8BSxT87R2LnPBmkqd/HYyPy578uNEZKQ/i9Dvi
njvHyEnigtaOzzthaXVWvVkOF3GWn3dGUY5lkU+EKypZXsFpv7vAyt5+R8qk
KxTZ/iW0US6Sb295R/vZDfPNfPW7opaxqzaf647oWLF+N7w8cEFeU+OOCl61
fjd03Zhmc/Z5oHV5ln53lDWeuWsy7gFBabh+d0S+np/ITPXE0NYlcmaqB+jt
513ELB5C0/udxCxPpJZHNHmX8jATKKvzLvXEv8nBokARH6WGd0IDRTys8TxS
MdLHR5jsSdNIHw/UC2nE9VgvqOMdDK7H8uG3K2/i0lIBghzes/KXeoHT+C6a
VSBANLvQ1KbAC5OrxW19lDcss4wf91ACXBNXxfzW7Y0jbd3yqm4BmArfaftD
65GWPWztfcgb2coJ8TO6EO3TpVsa6OvRcruz5tNlIZKXf2GmvLwew7kXd/i5
EJA7SF9WuAgxE3as41UTgYlcFqe3WYguKwXxbg+JIlnUy607CdSaJ2QmhJJQ
aeN1pbsJFDFC2xeGk2hu8PD4ci8BGd3xoLWYhNX4iepH+wmYzNYpgmJJtPLm
LbaKIhDQqR0pyyCxoDin+WoSgUfnQy7KSkh8zxDzOgsI3FIIBgzKSHQ5S0YZ
Nwlkn7bmni4n0WYqjfIvJLA7c6T+torEkXJeraqYwH+yE5rXdSSm+OxT6eUE
XLff8xW+IrEv9u7D3noCFiEXzj3tJKF0UZsseErgk0jes/UNCcHhuBUOjQRa
NvrFS/4iETKWbCJpJXCQ13/l8iiJ550NeX93EAhyaxheO0Yit7rqo+4VAb5z
iecDDQntnPKDeReBBfbHmp5Nkug2Z1d83UtgdFWY2XfTJGQFKfG7+gi0MzeF
Dc2S+Gc2TS3pJ1C5wunXeB2JSrl5nnyAQIEpY2pujsTxn9jTuYME/gfDUyPU

       "]]},
     Annotation[#, "Charting`Private`Tag$55831#2"]& ]}, {}},
  AspectRatio->NCache[GoldenRatio^(-1), 0.6180339887498948],
  Axes->{True, True},
  AxesLabel->{None, None},
  AxesOrigin->{1., 0},
  DisplayFunction->Identity,
  Frame->{{False, False}, {False, False}},
  FrameLabel->{{None, None}, {None, None}},
  FrameTicks->{{Automatic, Automatic}, {Automatic, Automatic}},
  GridLines->{None, None},
  GridLinesStyle->Directive[
    GrayLevel[0.5, 0.4]],
  ImagePadding->All,
  Method->{
   "DefaultBoundaryStyle" -> Automatic, 
    "DefaultGraphicsInteraction" -> {
     "Version" -> 1.2, "TrackMousePosition" -> {True, False}, 
      "Effects" -> {
       "Highlight" -> {"ratio" -> 2}, "HighlightPoint" -> {"ratio" -> 2}, 
        "Droplines" -> {
         "freeformCursorMode" -> True, 
          "placement" -> {"x" -> "All", "y" -> "None"}}}}, "DefaultMeshStyle" -> 
    AbsolutePointSize[6], "ScalingFunctions" -> None, 
    "CoordinatesToolOptions" -> {"DisplayFunction" -> ({
        (Identity[#]& )[
         Part[#, 1]], 
        (Identity[#]& )[
         Part[#, 2]]}& ), "CopiedValueFunction" -> ({
        (Identity[#]& )[
         Part[#, 1]], 
        (Identity[#]& )[
         Part[#, 2]]}& )}},
  PlotRange->{{1, 30}, {0., 29.900619038039146`}},
  PlotRangeClipping->True,
  PlotRangePadding->{{
     Scaled[0.02], 
     Scaled[0.02]}, {
     Scaled[0.05], 
     Scaled[0.05]}},
  Ticks->{Automatic, Automatic}]], "Output",
 CellChangeTimes->{
  3.857743657528632*^9, {3.857746581724403*^9, 3.8577465873984976`*^9}, 
   3.8577467142209034`*^9, 3.8577467660579777`*^9, 3.85783133141379*^9, 
   3.8610985148104253`*^9},
 CellLabel->
  "Out[190]=",ExpressionUUID->"6c441635-9b54-4b4c-8bd5-691300a395ed"]
}, Open  ]],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.8577431389845915`*^9, 3.857743181423046*^9}, {
   3.857746594316637*^9, 3.857746596328169*^9}, {3.857746716801547*^9, 
   3.8577467184907827`*^9}, 3.8577472159865437`*^9},
 CellLabel->
  "In[191]:=",ExpressionUUID->"3c3ef42f-7272-4fca-80d2-01ce0e9da364"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.8577447362109594`*^9, 3.8577447790582557`*^9}, {
   3.857744812952944*^9, 3.8577448312235446`*^9}, 3.857746228143039*^9, {
   3.857746597732473*^9, 3.8577465989801593`*^9}, {3.85774671990417*^9, 
   3.857746721555354*^9}, 3.857747224843954*^9},
 CellLabel->
  "In[192]:=",ExpressionUUID->"53a0ad7d-56d4-40a7-8a4f-f1142541d367"],

Cell[BoxData[
 RowBox[{
  RowBox[{"flowHornSchunck", "[", 
   RowBox[{"i_", ",", "length_", ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"f1_", ",", "f1x_"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"f2_", ",", "f2x_"}], "}"}]}], "}"}], ",", "lamda_"}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "u", ",", "u1", ",", "mask", ",", "fx", ",", "ft", ",", "uav", ",", "p", 
      ",", "d"}], "}"}], ",", 
    RowBox[{"(", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"We", " ", "define", " ", "fx"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"fx", "[", "x_", "]"}], ":=", 
       RowBox[{"0.5", "*", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"f1x", "[", "x", "]"}], "+", 
          RowBox[{"f2x", "[", "x", "]"}]}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"We", " ", "define", " ", "ft"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"ft", "[", "x_", "]"}], ":=", 
       RowBox[{
        RowBox[{"f2", "[", "x", "]"}], "-", 
        RowBox[{"f1", "[", "x", "]"}]}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"mask", "=", 
       RowBox[{"{", 
        RowBox[{"1", ",", 
         RowBox[{"-", "2"}], ",", "1"}], "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"u", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0.", ",", 
         RowBox[{"{", 
          RowBox[{"k", ",", "length"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"u1", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0.", ",", 
         RowBox[{"{", 
          RowBox[{"k", ",", "length"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Do", "[", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"uav", "=", 
             RowBox[{"Mean", "[", 
              RowBox[{
               RowBox[{"u", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"x", "-", "1"}], ";;", 
                  RowBox[{"x", "+", "1"}]}], "]"}], "]"}], "*", "mask"}], 
              "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"p", "=", 
             RowBox[{
              RowBox[{
               RowBox[{"fx", "[", "x", "]"}], "*", "uav"}], "+", 
              RowBox[{"ft", "[", "x", "]"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"d", "=", 
             RowBox[{"lamda", "+", 
              RowBox[{
               RowBox[{"fx", "[", "x", "]"}], "^", "2"}]}]}], " ", ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"u1", "[", 
              RowBox[{"[", "x", "]"}], "]"}], "=", 
             RowBox[{"uav", "-", 
              RowBox[{
               RowBox[{"fx", "[", "x", "]"}], "*", 
               RowBox[{"p", "/", "d"}]}]}]}], ";"}], "\[IndentingNewLine]", 
           ",", 
           RowBox[{"{", 
            RowBox[{"x", ",", 
             RowBox[{"Range", "[", 
              RowBox[{"2", ",", 
               RowBox[{"length", "-", "1"}]}], "]"}]}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"u", "=", "u1"}], ";"}], "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"k", ",", "i"}], "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", "u"}], "\[IndentingNewLine]", ")"}]}], 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8577468470368423`*^9, 3.8577469425404253`*^9}, {
  3.8577469868144803`*^9, 3.8577470571044703`*^9}, {3.8577470954633365`*^9, 
  3.857747116182021*^9}, {3.857747183063691*^9, 3.8577472741463537`*^9}, {
  3.8577473658933053`*^9, 3.8577474829954777`*^9}, {3.8577475172678056`*^9, 
  3.8577475654822025`*^9}, {3.8577479618260255`*^9, 3.857747981513132*^9}},
 CellLabel->
  "In[193]:=",ExpressionUUID->"bd0964c2-c06c-4eda-800f-42ce76e7a352"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"flowHornSchunck", "[", 
  RowBox[{"10", ",", "30", ",", 
   RowBox[{"pyrf12", "[", 
    RowBox[{"[", "1", "]"}], "]"}], ",", "1"}], "]"}]], "Input",
 CellChangeTimes->{{3.8577473109213552`*^9, 3.8577473481149893`*^9}, {
  3.85783132355956*^9, 3.8578313654268737`*^9}, {3.8578314202333393`*^9, 
  3.8578314221131554`*^9}, {3.861098539752142*^9, 3.861098540676114*^9}, {
  3.8611001044443135`*^9, 3.861100104961888*^9}},
 CellLabel->
  "In[196]:=",ExpressionUUID->"adfe7342-9754-42cb-ae63-4db74df4b646"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "0.`", ",", "0.4348375767069731`", ",", "0.49191205272211347`", ",", 
   "0.498827348996812`", ",", "0.4999472940333051`", ",", 
   "0.4999447807478705`", ",", "0.5000113051740133`", ",", 
   "0.49999637764320176`", ",", "0.5000005082768102`", ",", 
   "0.49999994939373593`", ",", "0.4999999999887169`", ",", 
   "0.49999999999924416`", ",", "0.49999999999994477`", ",", 
   "0.4999999999999966`", ",", "0.49999999999999917`", ",", 
   "0.5000000000000002`", ",", "0.49999999999999595`", ",", 
   "0.49999999999994343`", ",", "0.4999999999992457`", ",", 
   "0.49999999998871963`", ",", "0.4999999493937348`", ",", 
   "0.5000005082768094`", ",", "0.4999963776432022`", ",", 
   "0.5000113051740153`", ",", "0.49994478074787263`", ",", 
   "0.49994729403330423`", ",", "0.49882734899680875`", ",", 
   "0.49191205272211175`", ",", "0.43483757670697276`", ",", "0.`"}], 
  "}"}]], "Output",
 CellChangeTimes->{
  3.8577474779403243`*^9, 3.8577475689622583`*^9, {3.8578313319399147`*^9, 
   3.8578313554826365`*^9}, {3.8578314105795617`*^9, 
   3.8578314224982047`*^9}, {3.861098515054387*^9, 3.861098541190086*^9}, 
   3.8611001058388076`*^9},
 CellLabel->
  "Out[196]=",ExpressionUUID->"643d064b-1bc4-43ba-a844-81ae06587782"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
},
AutoGeneratedPackage->Automatic,
WindowSize->{574.8, 586.8},
WindowMargins->{{Automatic, -4.7999999999999545`}, {Automatic, 0}},
FrontEndVersion->"12.2 for Microsoft Windows (64-bit) (December 12, 2020)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"3a4f8af2-22f8-4bc6-8195-15ba894ee615"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 555, 8, 97, "Title",ExpressionUUID->"c7890b51-e7b4-4fef-b7f7-d75a1e472cd0"],
Cell[CellGroupData[{
Cell[1160, 34, 359, 6, 67, "Section",ExpressionUUID->"e88658b6-d70f-43e0-bf8f-0fbc4dd6965f"],
Cell[1522, 42, 430, 9, 28, "Input",ExpressionUUID->"5ded1e1c-cacc-4124-ae6f-cae13c483669"],
Cell[1955, 53, 594, 17, 68, "Input",ExpressionUUID->"fb634eba-f95f-4387-a906-abb7f9c65b2a"],
Cell[2552, 72, 366, 7, 49, "Input",ExpressionUUID->"bbb68d07-3330-46e0-af4b-42d17f5fc983"],
Cell[2921, 81, 324, 7, 28, "Input",ExpressionUUID->"e2e06ea2-9234-4f36-ad81-bc4587977350"]
}, Closed]],
Cell[CellGroupData[{
Cell[3282, 93, 337, 5, 53, "Section",ExpressionUUID->"19bdc259-fd11-45ff-a577-d84476daf64c"],
Cell[3622, 100, 271, 6, 28, "Input",ExpressionUUID->"854159ec-bc25-4b3c-a87a-910454c18b36"],
Cell[3896, 108, 3293, 81, 166, "Input",ExpressionUUID->"77b35f64-33ee-4524-92a9-1aa55c2b27f3"],
Cell[CellGroupData[{
Cell[7214, 193, 2368, 66, 166, "Input",ExpressionUUID->"15ff7e93-620d-4108-980e-64d93642cd94"],
Cell[9585, 261, 5303, 110, 239, "Output",ExpressionUUID->"6c441635-9b54-4b4c-8bd5-691300a395ed"]
}, Open  ]],
Cell[14903, 374, 303, 5, 28, "Input",ExpressionUUID->"3c3ef42f-7272-4fca-80d2-01ce0e9da364"],
Cell[15209, 381, 376, 6, 28, "Input",ExpressionUUID->"53a0ad7d-56d4-40a7-8a4f-f1142541d367"],
Cell[15588, 389, 4153, 104, 552, "Input",ExpressionUUID->"bd0964c2-c06c-4eda-800f-42ce76e7a352",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[19766, 497, 525, 10, 28, "Input",ExpressionUUID->"adfe7342-9754-42cb-ae63-4db74df4b646"],
Cell[20294, 509, 1268, 24, 92, "Output",ExpressionUUID->"643d064b-1bc4-43ba-a844-81ae06587782"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}
]
*)

